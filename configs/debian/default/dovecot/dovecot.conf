# DOVECOT(1) configuration file - auto-generated by i-MSCP
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
#
# You can override default settings by adding *.conf configuration files into
# the /etc/dovecot/imscp.d/ configuration directory.

# Defaults

default_client_limit = {DOVECOT_DEFAULT_CLIENT_LIMIT}

# Mail location
mail_location = maildir:~/

# Namespaces
namespace inbox {
    separator = .
    prefix = INBOX.
    inbox = yes
    type = private

    mailbox Drafts {
        special_use = \Drafts
        auto=subscribe
    }

    mailbox Junk {
        special_use = \Junk
        auto=subscribe
    }

    mailbox Sent {
        special_use = \Sent
        auto=subscribe
    }

    mailbox Trash {
        special_use = \Trash
        auto=subscribe
    }
}

# Plugins

mail_plugins = quota

plugin {
    quota = maildir:User quota
    quota_rule = *:storage=1G
    quota_rule2 = INBOX.Trash:storage=+100M
    quota_warning = storage=95%% quota-warning 95 %u
    quota_warning2 = storage=80%% quota-warning 80 %u
}

# Password database

passdb {
    args = {DOVECOT_CONF_DIR}/dovecot-sql.conf
    driver = sql
}

# Users database

userdb {
    driver = prefetch
}

userdb {
    args = {DOVECOT_CONF_DIR}/dovecot-sql.conf
    driver = sql
}

#
## Services
#

# Authentication

auth_mechanisms = plain login
disable_plaintext_auth = no

service auth {
    unix_listener auth-master {
        mode = 0600
        user = {MTA_MAILBOX_UID_NAME}
    }

    # SASL authentication
    unix_listener {DOVECOT_SASL_AUTH_SOCKET_PATH} {
        mode = 0660
        user = {POSTFIX_USER}
        group = {POSTFIX_GROUP}
    }
}

# IMAP

service imap-login {
    process_limit = {DOVECOT_IMAP_LOGIN_PROCESS_LIMIT}
    process_min_avail = {DOVECOT_IMAP_LOGIN_PROCESS_MIN_AVAIL}
    service_count = {DOVECOT_IMAP_LOGIN_PROCESS_SERVICE_COUNT}
}

service imap {
    process_limit = {DOVECOT_IMAP_PROCESS_LIMIT}
    process_min_avail = {DOVECOT_IMAP_PROCESS_MIN_AVAIL}
    service_count =  {DOVECOT_IMAP_PROCESS_SERVICE_COUNT}
    vsz_limit = {DOVECOT_IMAP_VSZ_LIMIT}
}

# POP3

service pop3-login {
    process_limit = {DOVECOT_POP3_LOGIN_PROCESS_LIMIT}
    process_min_avail = {DOVECOT_POP3_LOGIN_PROCESS_MIN_AVAIL}
    service_count = {DOVECOT_POP3_LOGIN_PROCESS_SERVICE_COUNT}
}

service pop3 {
    process_limit = {DOVECOT_POP3_PROCESS_LIMIT}
    process_min_avail = {DOVECOT_POP3_PROCESS_MIN_AVAIL}
    service_count = {DOVECOT_POP3_PROCESS_SERVICE_COUNT}
}

# Quota

service quota-warning {
    executable = script {ENGINE_ROOT_DIR}/quota/imscp-dovecot-quota.sh
    group = {IMSCP_GROUP}

    unix_listener quota-warning {
        mode = 0600
        user = {MTA_MAILBOX_UID_NAME}
    }
}

# Interfaces to listen on
listen = {NETWORK_PROTOCOLS}

# max connection per IP
mail_max_userip_connections = {DOVECOT_MAX_USERIP_CONNECTIONS}

!include_try /usr/share/dovecot/protocols.d/*.protocol

# Including override files (they must be included before any filter
# that make use of global setting
!include_try {DOVECOT_CONF_DIR}/imscp.d/*.conf

#
## Protocols
#

# IMAP

protocol imap {
    mail_plugins = $mail_plugins imap_quota
    imap_logout_format = in=%i out=%o
}

# POP3

protocol pop3 {
    pop3_uidl_format = %u-%v
    pop3_logout_format = top=%t/%p, retr=%r/%b, del=%d/%m, size=%s, in=%i, out=%o 
}

# LDA

protocol lda {
    auth_socket_path = {DOVECOT_LDA_AUTH_SOCKET_PATH}
    mail_plugins = $mail_plugins
    postmaster_address = postmaster@{HOSTNAME}
}
