# proftpd(8) configuration file - auto-generated by i-MSCP
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

# Load required modules
Include /etc/proftpd/modules.conf

<IfModule !mod_sql.c>
  LoadModule               mod_sql.c
</IfModule>
<IfModule !mod_sql_mysql.c>
  LoadModule               mod_sql_mysql.c
</IfModule>
<IfModule !mod_quotatab.c>
  LoadModule               mod_quotatab.c
</IfModule>
<IfModule !mod_quotatab_sql.c>
  LoadModule               mod_quotatab_sql.c
</IfModule>
<IfModule !mod_tls.c>
  LoadModule               mod_tls.c
</IfModule>

# Server configuration
ServerName                 "{HOSTNAME}"
ServerType                 standalone
UseIPv6                    {IPV6_SUPPORT}
UseReverseDNS              off
MultilineRFC2228           on
DefaultServer              on
LogFormat                  traff "%b %u"
Port                       21
MaxInstances               {MAX_INSTANCES}
User                       proftpd
Group                      nogroup

<IfModule mod_ctrls.c>
  ControlsEngine           off
  ControlsMaxClients       2
  ControlsLog              /var/log/proftpd/controls.log
  ControlsInterval         5
  ControlsSocket           /var/run/proftpd/proftpd.sock
</IfModule>

<IfModule mod_ctrls_admin.c>
  AdminControlsEngine      off
</IfModule>

# Global configuration parameters (apply to all servers, including default server)
<Global>
  ServerIdent              on {SERVER_IDENT_MESSAGE}
  DeferWelcome             off
  ShowSymlinks             on
  AllowOverwrite           on
  IdentLookups             off
  AllowStoreRestart        on
  AllowForeignAddress      on
  TimeoutLogin             120
  TimeoutNoTransfer        600
  TimeoutStalled           600
  TimeoutIdle              1200
  DisplayLogin             welcome.msg
  DisplayChdir             message
  ListOptions              "-a +R" "strict"
  DenyFilter               \*.*/
  DefaultRoot              ~
  PassivePorts             {FTPD_PASSIVE_PORT_RANGE}
  MaxClientsPerHost        {MAX_CLIENT_PER_HOST}

  <Directory /*>
    Umask                  027  027
    AllowOverwrite         on
    HideNoAccess           on
  </Directory>

  <Limit ALL>
    IgnoreHidden           on
  </Limit>

  RootLogin                off
  TransferLog              /var/log/proftpd/xferlog
  PathDenyFilter           "\.quota$"

  <IfModule mod_quotatab.c>
    QuotaEngine            on
    QuotaShowQuotas        on
    QuotaDisplayUnits      Mb
    SQLNamedQuery          get-quota-limit SELECT "name, quota_type, per_session, limit_type, bytes_in_avail, bytes_out_avail, bytes_xfer_avail, files_in_avail, files_out_avail, files_xfer_avail FROM quotalimits WHERE name = '%{0}' AND quota_type = '%{1}'"
    SQLNamedQuery          get-quota-tally SELECT "name, quota_type, bytes_in_used, bytes_out_used, bytes_xfer_used, files_in_used, files_out_used, files_xfer_used FROM quotatallies WHERE name = '%{0}' AND quota_type = '%{1}'"
    SQLNamedQuery          update-quota-tally UPDATE "bytes_in_used = bytes_in_used + %{0}, bytes_out_used = bytes_out_used + %{1}, bytes_xfer_used = bytes_xfer_used + %{2}, files_in_used = files_in_used + %{3}, files_out_used = files_out_used + %{4}, files_xfer_used = files_xfer_used + %{5} WHERE name = '%{6}' AND quota_type = '%{7}'" quotatallies
    SQLNamedQuery          insert-quota-tally INSERT "%{0}, %{1}, %{2}, %{3}, %{4}, %{5}, %{6}, %{7}" quotatallies
    QuotaLock              /var/run/proftpd/tally.lock
    QuotaLimitTable        sql:/get-quota-limit
    QuotaTallyTable        sql:/get-quota-tally/update-quota-tally/insert-quota-tally
  </IfModule>

  <IfModule mod_delay.c>
    DelayEngine            on
  </IfModule>

  <IfModule mod_sql.c>
    AuthOrder              mod_sql.c
    SQLBackend             mysql
    SQLAuthTypes           Crypt
    SQLAuthenticate        on
    SQLConnectInfo         {DATABASE_NAME}@{DATABASE_HOST} {DATABASE_USER} {DATABASE_PASS}
    SQLUserInfo            ftp_users userid passwd uid gid homedir shell
    SQLGroupInfo           ftp_group groupname gid members
    SQLMinUserUID          {FTPD_MIN_UID}
    SQLMinUserGID          {FTPD_MIN_GID}
    SQLUserWhereClause     "status = 'ok'"
    SQLNegativeCache       on
  </IfModule>
</Global>
