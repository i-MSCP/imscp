# DOVECOT(1) (SQL) configuration file - auto-generated by i-MSCP
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
driver = {DATABASE_TYPE}
connect = "host={DATABASE_HOST} port={DATABASE_PORT} dbname={DATABASE_NAME} user={DATABASE_USER} password={DATABASE_PASSWORD}"
default_pass_scheme = SHA512-CRYPT

# Password database lookups (including all the necessary userdb fields for prefetching)
password_query = \
	SELECT \
		CONCAT('{MTA_VIRTUAL_MAIL_DIR}/', SUBSTRING(mail_addr, LOCATE('@', mail_addr) + 1), '/', mail_acc, '/') AS 'userdb_home', \
		'{MTA_MAILBOX_UID}' AS 'userdb_uid', \
		'{MTA_MAILBOX_GID}' AS 'userdb_gid', \
		CONCAT('*:bytes=', quota, 'B') AS userdb_quota_rule, \
		mail_pass AS password \
	FROM mail_users \
	WHERE mail_addr = '%u' \
	AND status = 'ok' \
	AND po_active = 'yes'

# User database lookups
user_query = \
	SELECT \
		CONCAT('{MTA_VIRTUAL_MAIL_DIR}/', SUBSTRING(mail_addr, LOCATE('@', mail_addr) +1), '/', mail_acc, '/') AS home, \
		'{MTA_MAILBOX_UID}' AS 'uid', \
		'{MTA_MAILBOX_GID}' AS 'gid', \
		CONCAT('*:bytes=', quota, 'B') AS 'quota_rule'\
	FROM mail_users \
	WHERE mail_addr = '%u' \
	AND status = 'ok' \
	AND po_active = 'yes'

# User iteration
iterate_query = SELECT mail_addr AS user FROM mail_users WHERE mail_type LIKE '%%_mail%%' && status <> 'todelete'
